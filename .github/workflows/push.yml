name: Build

on:
  push:
    branches:
      - master
    tags:
      - "v[0-9]+.[0-9]+.[0-9]+"

jobs:
  teifi-shopify-app:
    uses: teifi-digital/workflows/.github/workflows/teifi-shopify-app.yml@master
    with:
      name: "Teifi Shopify App Template"
      shopify_api_key: ${{ vars.SHOPIFY_API_KEY }}
      sentry_org: ${{ vars.SENTRY_ORG }}
      sentry_project: ${{ vars.SENTRY_PROJECT }}
    secrets: inherit
  deploy:
    uses: teifi-digital/shopify-app-deployments/.github/workflows/pulumi-up.yml@master
    needs: teifi-shopify-app
    with:
      stack_name: ${{ vars.PRODUCTION_STACK_NAME }}
    secrets: inherit
